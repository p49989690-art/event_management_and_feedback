name: Sync to Client (Robust Auth)

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Personal Repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Configure Git Credentials
        run: |
          git config --global user.name "Zikri809"
          git config --global user.email "your-email@student.uum.edu.my" # Optional, but good for logs

          # This line creates a credential rule. 
          # Anytime git sees 'github.com', it uses your Token as the password.
          git config --global credential.helper store
          echo "https://Zikri809:${{ secrets.CLIENT_REPO_TOKEN }}@github.com" > ~/.git-credentials

      - name: Sync Push
        run: |
          # Notice: No token in the URL anymore. Pure and clean.
          CLIENT_URL="https://github.com/p49989690-art/event_management_and_feedback.git"
          
          echo "Adding remote..."
          git remote add client_target "$CLIENT_URL"
          
          echo "Pushing code..."
          # We force push to make sure their repo matches yours exactly
          git push client_target main --force
